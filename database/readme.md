# Database Setup & Usage

This folder contains the database-related files for the project.

## About the Database ORM

We switched from **Prisma** to **Kysely** for database interactions in this project.

- **Why?**  
  Kysely offers better type safety and flexibility with SQL queries but requires a bit more manual setup than Prisma.

- **What changed?**  
  - No more autogenerated Prisma Client.  
  - Manual migrations are handled via SQL scripts or direct execution.  
  - Database schema is defined with TypeScript interfaces instead of Prisma schema files.

## Database Files

- `src/database/index.ts`: sets up the Kysely client instance.
- `src/database/migrations.ts`: SQL scripts to create tables and manage schema.
- `src/database/db.types.ts`: Models are defined as TypeScript interfaces to keep type safety.

## Setting Up the Database

1. Make sure your file path has the connection string set.
2. Run the migration scripts to create necessary tables. For example:

   ```bash
   npm run db:migrate

   ```

3. The tables created by default include:
  
   - `users` (primary key: `user_id`)
   - `test`  (primary key: `user_id` and is used for jest testing.)

## Using Kysely in Tests

- Tests directly interact with Kysely queries.
- Example test files can be found in `src/__test__/database.test.ts`.
- Remember to clean up test data after running tests.

## Helpful Tips

- Kysely queries look more verbose than Prisma but give you more control.
- Use the `db` instance imported from `src/database/db.types.ts` to make queries.
- Check out [Kysely docs](https://kysely.dev/docs/getting-started) for advanced usage and query building.
